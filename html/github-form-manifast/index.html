<!-- NOTE: ai generated javascript -->

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub App Creator</title>
  </head>
  <body>
    <h1>GitHub App Creator</h1>
    <p>Paste JSON with manifest, state, and optionally org:</p>
    <textarea
      id="jsonInput"
      style="width: 100%; height: 400px; font-family: monospace"
      placeholder='{"manifest": {...}, "state": "...", "org": "org-name"}'
    ></textarea>
    <br />
    <button id="createBtn">Create App</button>
    <div id="info" style="margin-top: 10px; color: #666"></div>
    <script>
      document.getElementById("createBtn").onclick = function () {
        const input = document.getElementById("jsonInput").value.trim();
        if (!input) {
          show("Paste JSON first", "red");
          return;
        }
        let data;
        try {
          data = JSON.parse(input);
        } catch (e) {
          show("Invalid JSON: " + e.message, "red");
          return;
        }
        const manifest = data.manifest;
        const state = data.state;
        const org = data.org;

        if (!manifest || !state) {
          show("Need manifest + state in JSON", "red");
          return;
        }

        // Build the action URL based on whether org is provided
        let actionUrl;
        if (org) {
          actionUrl = `https://github.com/organizations/${encodeURIComponent(org)}/settings/apps/new?state=${encodeURIComponent(state)}`;
          show(`Creating app for organization: ${org}`, "green");
        } else {
          actionUrl = `https://github.com/settings/apps/new?state=${encodeURIComponent(state)}`;
          show("Creating personal app", "green");
        }

        const manifestStr = JSON.stringify(manifest).replace(/'/g, "&#39;");
        const formHtml =
          '<!DOCTYPE html><html><body><form id="f" action="' +
          actionUrl +
          '" method="post"><input type="hidden" name="manifest" value=\'' +
          manifestStr +
          '\'></form><script>document.getElementById("f").submit();<\/script></body></html>';

        const win = window.open("", "_blank");
        if (!win) {
          show("Popup blocked! Allow popups and try again", "red");
          return;
        }
        win.document.write(formHtml);
        win.document.close();
      };

      function show(msg, color) {
        const info = document.getElementById("info");
        info.textContent = msg;
        info.style.color = color || "#666";
      }
    </script>
  </body>
</html>
